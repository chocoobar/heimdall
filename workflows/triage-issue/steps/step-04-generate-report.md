---
name: 'step-04-generate-report'
description: 'Generate triage report with recommendations'
workflow_path: '_bmad/sre/workflows/triage-issue'
thisStepFile: './step-04-generate-report.md'
nextStepFile: null
---

# Step 4: Generate Triage Report

**Goal:** Generate comprehensive triage report and provide recommendations.

---

## AVAILABLE STATE

From previous steps:
- `{ticket_id}` - JIRA ticket identifier
- `{ticket_data}` - Complete ticket content
- `{mcp_status}` - MCP connection status
- `{issue_category}` - Issue classification
- `{assessed_severity}` - Severity level
- `{identified_patterns}` - Recognized patterns
- `{impact_assessment}` - Impact metrics
- `{root_cause_hypothesis}` - Primary hypothesis
- `{root_cause_confidence}` - Confidence level
- `{investigation_recommendations}` - Investigation steps
- `{similar_incidents}` - Related past incidents

---

## REPORT GENERATION

### 1. Generate Triage Report

Create report at `{sre_artifacts}/triage/triage-{ticket_id}-{date}.md`:

```markdown
# Triage Report: {ticket_id}

**Generated:** {timestamp}
**Analyst:** Heimdall (SRE Agent)
**Source:** {MCP | Manual Input}

---

## Summary

| Field | Value |
|-------|-------|
| **Ticket ID** | {ticket_id} |
| **Issue Category** | {issue_category} |
| **Assessed Severity** | {assessed_severity} |
| **Original Priority** | {current_priority} |
| **Recommended Priority** | {recommended_priority} |
| **Confidence** | {root_cause_confidence} |

---

## Ticket Details

**Summary:** {ticket_summary}

**Description:**
{ticket_description}

---

## Analysis

### Issue Classification
{issue_category} - {classification_reasoning}

### Severity Assessment
**Assessed:** {assessed_severity}
**Rationale:** {severity_reasoning}

### Patterns Identified
{identified_patterns_formatted}

### Impact Assessment
| Metric | Value |
|--------|-------|
| Users Affected | {affected_users} |
| Duration | {duration} |
| SLO Impact | {slo_impact} |

---

## Root Cause Analysis

### Primary Hypothesis
{root_cause_hypothesis}

**Confidence:** {root_cause_confidence}

### Evidence
{evidence_list}

### 5 Whys Analysis
{five_whys_formatted}

### Alternative Hypotheses
{alternative_hypotheses}

---

## Recommendations

### Immediate Actions
1. {immediate_action_1}
2. {immediate_action_2}
3. {immediate_action_3}

### Investigation Steps
{investigation_recommendations_formatted}

### Metrics to Monitor
```promql
{prometheus_queries}
```

### Logs to Review
- Pattern: `{error_pattern}`
- Timeframe: {start_time} to {end_time}
- Components: {affected_components}

---

## Related Incidents
{similar_incidents_formatted}

---

## Next Steps

- [ ] Assign to appropriate team
- [ ] Begin investigation per recommendations
- [ ] Update SLO tracking if breach occurred
- [ ] Schedule postmortem if P1/P2

---

*Generated by Heimdall SRE Agent*
```

---

### 2. Priority Recommendation

Compare assessed severity with current priority:

| Assessed | Current | Recommendation |
|----------|---------|----------------|
| P1 | P2/P3 | **ESCALATE** to P1 |
| P2 | P3 | Consider escalating to P2 |
| P3 | P1/P2 | May be over-prioritized |
| Same | Same | Priority appropriate |

If priority change recommended, explain rationale.

---

### 3. Validate Report

Validation checklist:
- [ ] Summary section complete
- [ ] Severity assessment justified
- [ ] Root cause hypothesis documented
- [ ] Recommended actions provided
- [ ] All required fields populated

**If validation fails:** Note missing sections and complete.

---

### 4. Output Report

Save report to `{sre_artifacts}/triage/`.

If `{mcp_confluence_enabled}` = true:
- Attempt to publish to Confluence
- Link Confluence page in JIRA ticket

If Confluence not available:
- Display local file path

---

## FINAL OUTPUT

Display summary in ultra-succinct Heimdall style:
```
üõ°Ô∏è Triage complete.

{ticket_id}. {assessed_severity}. {issue_category}.
Root cause: {root_cause_hypothesis_brief}.
Confidence: {root_cause_confidence}.
Action: {primary_recommendation}.

Report: {output_path}

Priority change: {YES ‚Üí {assessed} | NO}
```

---

## WORKFLOW COMPLETE

Ask user:
```
Continue with:
[1] Create Postmortem (if incident warrants)
[2] Performance Analysis (if performance issue)
[3] Return to Menu
```

**WAIT** for user input.

---

## SUCCESS METRICS

- Triage report generated
- Priority recommendation provided
- Root cause hypothesis documented
- Investigation steps actionable
- Report saved to artifacts

## FAILURE MODES

- Missing required sections in report
- Priority recommendation without justification
- Root cause analysis too vague
- No actionable investigation steps
